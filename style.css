const dersProgrami = {
    saatler: {
        normal: [
            { bas: "08:50", bit: "09:30" }, { bas: "09:45", bit: "10:25" },
            { bas: "10:40", bit: "11:20" }, { bas: "11:30", bit: "12:10" },
            { bas: "12:40", bit: "13:20" }, { bas: "13:30", bit: "14:10" },
            { bas: "14:20", bit: "15:00" }
        ],
        cuma: [
            { bas: "08:50", bit: "09:30" }, { bas: "09:45", bit: "10:25" },
            { bas: "10:35", bit: "11:10" }, { bas: "11:10", bit: "11:45" },
            { bas: "12:00", bit: "12:40" }, { bas: "13:15", bit: "13:55" },
            { bas: "14:10", bit: "14:50" }
        ]
    },
    dersler: {
        1: [{ders:"SEÇ. İNG", ogrt:"A. IŞIK"}, {ders:"SEÇ. İNG", ogrt:"A. IŞIK"}, {ders:"FEN", ogrt:"S. BAKAY"}, {ders:"FEN", ogrt:"S. BAKAY"}, {ders:"TRK 78", ogrt:"E. GÜRSOY"}, {ders:"TEK TAS", ogrt:"D. KARAGÖ"}, {ders:"TEK TAS", ogrt:"D. KARAGÖ"}],
        2: [{ders:"MAT", ogrt:"C. KUTLU"}, {ders:"MAT", ogrt:"C. KUTLU"}, {ders:"İNG 7-8", ogrt:"A. IŞIK"}, {ders:"İNG 7-8", ogrt:"A. IŞIK"}, {ders:"SOS", ogrt:"M. MERAM"}, {ders:"GÖR", ogrt:"E. KARAKA"}, {ders:"SEÇ. KÜL", ogrt:"H. KOÇHAN"}],
        3: [{ders:"MAT", ogrt:"C. KUTLU"}, {ders:"MAT", ogrt:"C. KUTLU"}, {ders:"SEÇ. KÜL", ogrt:"H. KOÇHAN"}, {ders:"MÜZ", ogrt:"H. ERDOĞA"}, {ders:"TRK 78", ogrt:"E. GÜRSOY"}, {ders:"TRK 78", ogrt:"E. GÜRSOY"}, {ders:"REH", ogrt:"A. IŞIK"}],
        4: [{ders:"İNG 7-8", ogrt:"A. IŞIK"}, {ders:"İNG 7-8", ogrt:"A. IŞIK"}, {ders:"FEN", ogrt:"S. BAKAY"}, {ders:"FEN", ogrt:"S. BAKAY"}, {ders:"SEÇ. MAT", ogrt:"S. KARAGÖ"}, {ders:"TRK 78", ogrt:"E. GÜRSOY"}, {ders:"TRK 78", ogrt:"E. GÜRSOY"}],
        5: [{ders:"DİN", ogrt:"A. ERSARI"}, {ders:"DİN", ogrt:"A. ERSARI"}, {ders:"BED", ogrt:"Y. KARACA"}, {ders:"BED", ogrt:"Y. KARACA"}, {ders:"SOS", ogrt:"M. MERAM"}, {ders:"SOS", ogrt:"M. MERAM"}, {ders:"MAT", ogrt:"C. KUTLU"}]
    }
};

function saatDakikaToDakika(saatStr) {
    const [saat, dakika] = saatStr.split(":").map(Number);
    return saat * 60 + dakika;
}

function sayaciGuncelle() {
    const simdi = new Date();
    const gun = simdi.getDay();
    const suankiDakika = simdi.getHours() * 60 + simdi.getMinutes();

    const lessonNameEl = document.getElementById("lesson-name");
    const teacherNameEl = document.getElementById("teacher-name");
    const countdownEl = document.getElementById("countdown-timer");
    const nextLessonEl = document.getElementById("next-lesson-info");

    if (gun === 0 || gun === 6) {
        lessonNameEl.innerText = "İyi Tatiller!";
        countdownEl.innerText = "--";
        nextLessonEl.innerText = "Pazartesi görüşürüz.";
        return;
    }

    const bugunkuSaatler = (gun === 5) ? dersProgrami.saatler.cuma : dersProgrami.saatler.normal;
    const bugunkuDersler = dersProgrami.dersler[gun];
    let dersteMi = false;

    for (let i = 0; i < bugunkuSaatler.length; i++) {
        const bas = saatDakikaToDakika(bugunkuSaatler[i].bas);
        const bit = saatDakikaToDakika(bugunkuSaatler[i].bit);

        if (suankiDakika >= bas && suankiDakika < bit) {
            dersteMi = true;
            lessonNameEl.innerText = bugunkuDersler[i].ders;
            teacherNameEl.innerText = bugunkuDersler[i].ogrt;
            countdownEl.innerText = bit - suankiDakika;
            nextLessonEl.innerText = (i + 1 < bugunkuDersler.length) ? `Sonraki: ${bugunkuDersler[i+1].ders}` : "Gün bitti!";
            break;
        }
    }

    if (!dersteMi) {
        lessonNameEl.innerText = "Teneffüs / Kapalı";
        countdownEl.innerText = "--";
    }
}

function toggleMenu() {
    document.getElementById("sideMenu").classList.toggle("active");
    document.querySelector(".overlay").classList.toggle("active");
}

function showSection(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active-section"));
    document.getElementById(id + "-section").classList.add("active-section");
    toggleMenu();
}

function tabloyuDoldur() {
    const table = document.getElementById("schedule-table");
    let html = `<thead><tr><th>Saat</th><th>Pzt</th><th>Sal</th><th>Çar</th><th>Per</th><th>Cum</th></tr></thead><tbody>`;
    for (let i = 0; i < 7; i++) {
        html += `<tr><td>${i+1}. Ders</td>`;
        for (let gun = 1; gun <= 5; gun++) {
            html += `<td>${dersProgrami.dersler[gun][i].ders}</td>`;
        }
        html += `</tr>`;
    }
    table.innerHTML = html + "</tbody>";
}

document.addEventListener("DOMContentLoaded", () => {
    sayaciGuncelle();
    setInterval(sayaciGuncelle, 1000);
    tabloyuDoldur();
});
